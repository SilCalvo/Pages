<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P3 Controlador de máquina expendedora</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-image: url('imagesP4.png');
            background-size: cover;
            background-repeat: no-repeat;
            background-attachment: fixed;
            background-position: center;
            color: white;
            display: flex;
            flex-direction: column;
            min-height: 100vh; /* Cambiado a min-height */
        }
        .sidebar {
            width: 140px;
            position: fixed;
            top: 10px;
            left: 10px;
            padding: 20px;
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 8px;
            margin-right: 5px;
        }
        .content {
            padding: 20px;
            background-color: rgba(0, 0, 0, 0.9);
            max-width: calc(60% - 50px);
            margin: auto;
            border-radius: 8px;
            flex: 1; 
            color: white;
        }
        .fixed-box {
            width: 75px;
            height: 35px;
            position: fixed; 
            bottom: 20px;
            background-color: rgba(0, 0, 0, 0.9);
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            text-decoration: none;
            font-size: 20px;
        }
        .left-box {
            left: 20px;
        }
        .right-box {
            right: 20px;
        }
        a {
            color: white;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        .footer {
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            text-align: center;
            padding: 20px;
            position: relative; 
            flex-shrink: 0;
            margin-top: 50px;
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <h3>Índice</h3>
        <ul>
            <li><a href="#INTRODUCCION">Introducción</a></li>
            <li><a href="#FUNCIONAMIENTO">Funcionamiento</a></li>
            <li><a href="#COMPONENTES">Componentes</a></li>
            <li><a href="#CONEXIONADO">Conexionado</a></li>
            <li><a href="#CONSIDERACIONES">Considera -ciones</a></li>
            <li><a href="#PRUEBAS">Pruebas</a></li>
            <li><a href="#RESULTADO_FINAL">Resultado Final</a></li>
        </ul>
       
    </div>
    <div class="content">
        <div style="text-align: center;">
            <big><big><span style="font-weight: bold;"> PRACTICA 3 CONTROLADOR MAQUINA EXPENDEDORA</span><br>
            <span style="font-weight: bold;">Silvia Calvo Cabello</span></big></big><br>
        </div>
        <br>
        <ul>
            <li><a name="INTRODUCCION"></a><strong>INTRODUCCIÓN</strong></li>
        </ul>
        <p>
             La práctica consiste en diseñar e implementar un controlador para una máquina expendedora utilizando un Arduino UNO y diversos sensores y actuadores. 
         

<p><strong>1. Arranque</strong></p>
    <ul>
        <li>Al iniciar, el <strong>LED1</strong> parpadea 3 veces, y se muestra el mensaje "CARGANDO..." en el LCD.</li>
        <li>Tras los parpadeos, el <strong>LED1</strong> se apaga y se muestra "Servicio" en el LCD.</li>
    </ul>

    <p><strong>2. Servicio</strong></p>
    <ul>
        <li>Si el usuario está a menos de 1 metro de la máquina, el LCD muestra la temperatura y humedad durante 5 segundos, y luego presenta una lista de productos con precios. Los productos incluyen diferentes tipos de café y chocolate.</li>
        <li>El usuario puede navegar por la lista utilizando el joystick y seleccionar un producto con el botón del joystick.</li>
        <li>Tras seleccionar, el LCD muestra "Preparando Café..." por un tiempo aleatorio entre 4 y 8 segundos. Durante este tiempo, el <strong>LED2</strong> se enciende de manera incremental, indicando el progreso de la preparación.</li>
        <li>Al terminar, el LCD muestra "RETIRE BEBIDA" por 3 segundos y vuelve al estado inicial.</li>
    </ul>

    <p><strong>3. Admin</strong></p>
    <ul>
        <li>Se puede acceder a la interfaz de administración presionando el botón durante 5 segundos.</li>
        <li>En la vista de Admin, ambos LEDs se encienden y se muestra un menú con opciones para ver la temperatura, la distancia del sensor, el contador de tiempo y modificar los precios de los productos.</li>
        <li>Los precios se modifican utilizando el joystick y confirmando con el botón. Los cambios de precio se actualizan en el menú de selección de productos.</li>
        <li>Para salir de la vista Admin, el usuario debe presionar el botón nuevamente durante 5 segundos.</li>
    </ul>

  Este sistema permite gestionar la máquina expendedora, realizar selecciones de productos y administrarla mediante un interfaz de usuario con los componentes de hardware mencionados.
             
            <br> <br> <br>
            <li><strong><a name="FUNCIONAMIENTO"></a>FUNCIONAMIENTO</strong></li>
        </ul>
        <p>
           EXPLICACION DEL CODIGO
        </p>
       
        <br>
        <ul>
            <li><strong><a name="COMPONENTES"></a>COMPONENTES</strong></li>
        </ul>
        <ul>
        <li>Arduino UNO</li>
        <li>LCD</li>
        <li>Joystick</li>
        <li>Sensor Temperatura/Humedad DHT11</li>
        <li>Sensor Ultrasonidos HC-SR04</li>
        <li>2 Botones</li>
        <li>2 LEDs (LED1 Amarillo, LED2 Verde)</li>
    </ul>

    <p><strong>1. Arduino UNO</strong></p>
    <p><strong>Para qué sirve:</strong> El Arduino UNO es la placa base que controla y gestiona todos los componentes conectados (sensores, botones, LEDs y la pantalla LCD). Actúa como el cerebro de la máquina expendedora, enviando y recibiendo señales a través de sus pines.</p>
    <p><strong>Cómo funciona:</strong> A través de sus pines de entrada y salida, el Arduino UNO recibe información de los sensores (como el DHT11 o el sensor ultrasonidos) y envía señales a los LEDs y al LCD. Realiza todas las operaciones necesarias para gestionar la máquina expendedora.</p>

    <p><strong>2. LCD</strong></p>
    <p><strong>Para qué sirve:</strong> El LCD sirve como interfaz visual entre la máquina y el usuario. Muestra información como la lista de productos, precios, temperatura y humedad, así como mensajes de estado como "Cargando..." o "Preparando Café...".</p>
    <p><strong>Cómo funciona:</strong> El Arduino UNO controla el LCD, enviando información a través de los pines de datos. El LCD es alimentado por la placa Arduino, y los mensajes que muestra son actualizados según las señales enviadas por el microcontrolador.</p>

    <p><strong>3. Joystick</strong></p>
    <p><strong>Para qué sirve:</strong> El joystick es un dispositivo de entrada que permite al usuario navegar por los menús y seleccionar productos en la máquina expendedora.</p>
    <p><strong>Cómo funciona:</strong> El joystick tiene dos funciones: el movimiento hacia arriba/abajo para navegar por las opciones y izquierda para salir del menu de cambio de precios al menu de administrador.</p>

    <p><strong>4. Sensor Temperatura/Humedad DHT11</strong></p>
    <p><strong>Para qué sirve:</strong> El sensor DHT11 mide la temperatura y la humedad del ambiente y proporciona estos datos al Arduino para que puedan ser mostrados en el LCD.</p>
    <p><strong>Cómo funciona:</strong> El sensor DHT11 tiene dos pines principales: uno para la alimentación (VCC) y otro para los datos (DATA). El Arduino lee estos datos de forma digital y los muestra en el LCD en tiempo real. El DHT11 es capaz de proporcionar lecturas de temperatura y humedad de manera precisa dentro de un rango determinado.</p>

    <p><strong>5. Sensor Ultrasonidos HC-SR04</strong></p>
    <p><strong>Para qué sirve:</strong> El sensor ultrasonidos HC-SR04 se utiliza para medir la distancia entre el sensor y un objeto (en este caso, la proximidad del usuario a la máquina expendedora).</p>
    <p><strong>Cómo funciona:</strong> El sensor emite ondas ultrasónicas a través del pin TRIG, y luego mide el tiempo que tarda la señal reflejada en regresar al pin ECHO. El Arduino calcula la distancia con base en este tiempo de regreso, permitiendo detectar si el usuario está a menos de 1 metro de la máquina.</p>

    <p><strong>6. Boton 1 (Seleccion) Boton 2 (Joystick) </strong></p>
    <p><strong>Para qué sirven:</strong> El boton 1 permite al usuario interactuar con la máquina. Se utiliza para realizar selecciones de productos y aceptar el cambio de precio de los productos. El botón 2 sirve para acceder al menú del administrador y salir de este.</p>
    <p><strong>Cómo funcionan:</strong> Los botones están conectados al Arduino, que detecta cuando son presionados, estando conectados a los pines 2 y 3 para las interrupciones</p>

        Son 2 botones porque el del joystick original no funcionaba y lo cambié por un botón normal

    <p><strong>7. LED1 (Amarillo) y LED2 (Verde)</strong></p>
    <p><strong>Para qué sirven:</strong> Los LEDs indican el estado de la máquina expendedora. El LED1 (amarillo) muestra el estado de arranque o de error, y el LED2 (verde) indica el progreso de la preparación del producto.</p>
    <p><strong>Cómo funcionan:</strong> El LED1 parpadea al inicio del sistema como una señal visual de que la máquina está arrancando. El LED2 se ilumina de manera progresiva durante la preparación de un producto (como el café), aumentando su intensidad conforme el proceso avanza. Ambos LEDs requieren resistencias de 220 ohmios para evitar que se sobrecalienten.</p>

        <ul>
            <li><strong><a name="CONEXIONADO"></a>CONEXIONADO</strong></li>
             </ul>
        <p>
       Foto del conexionado FRIZZ
             </p>
        <br>
        <ul>

         <li><strong><a name="CONSIDERACIONES"></a>CONSIDERACIONES</strong></li>
             </ul>
        <p>
       <p><strong>Boton joystick: </strong><br>Como ya se ha mencinado antes, el botón del joystic no funcionaba por lo que se usa un botón normal en su lugar.</p>
       <p><strong>Uso de if else y no switch case :</strong><br> .</p>
        <p><strong>Cambiar de target:</strong><br>Esta práctica se ha implementado de tal forma que una vez selecionado el target, no va a cambiar hasta que llegue al objetivo, y una vez alcanzado este, ya vuelve a calcular para el siguiente.</p>
        <br>
        <br>
        <ul>
            <li><a name="PRUEBAS"></a><strong>PRUEBAS</strong></li>
        </ul>
        <p><strong>Cálculo del cost_map:</strong> <br>Realicé varias pruebas en las que los resultados no eran correctos debido al orden en el que se recorrían los nodos hijos, como se mencionó anteriormente. Inicialmente, para familiarizarme con la conversión entre el mapa y el sistema de coordenadas del mundo, comencé calculando la distancia de cada píxel al objetivo sin usar BFS. Este enfoque me permitió entender mejor la relación entre ambos sistemas de coordenadas. Posteriormente, el cálculo final del mapa de costes se realiza utilizando BFS, tal como se explicó previamente.</p>
        <p><strong>Cálculo del wall_map:</strong> <br>Para calcular el mapa de obstáculos, al principio no tomaba en cuenta los obstáculos detectados por el cost_map y realizaba el cálculo sobre todo el mapa. Más adelante, optimicé este proceso, descartando las áreas donde no se había calculado el coste, lo que mejoró la eficiencia del algoritmo.</p> 
        <p><strong>Navegación:</strong> <br>Al principio, para determinar las casillas hacia las cuales se dirigía el coche, utilicé un enfoque en el que el vehículo se desplazaba de un píxel a otro, buscando siempre el píxel de menor coste. El coche llegaba a ese píxel, luego buscaba el siguiente con menor coste, y así sucesivamente. Este método ocasionaba que, en ocasiones, el coche se girara inesperadamente debido al error mencionado anteriormente en el orden de los nodos hijos. Una vez corregido este problema, la navegación mejoró significativamente.</p>
        <p><strong>Problema de ir hacia arriba:</strong> <br> Una vez hecho todo el proyecto, este no funcionaba al dirigirse hacia arriba en remoto y nunca iba en local, esto se debia al coste de los obstaculos (0) por lo que al intentar navegar se dirigía hacia las posiciones donde había obstáculos. Para solucionarlo, añadí que el coste fuese infinit por donde no pudiese ir el coche.</p>
       <br>
        <ul>
            <li><a name="RESULTADO_FINAL"></a><strong>RESULTADO FINAL</strong></li>
        </ul>
        <p>A continuacion se puede ver el funcionamiento del coche recorriendo la ciudad con varios objetivos.
            </p>
        <div style="text-align: center; margin-top: 20px;">
            <a href="https://urjc-my.sharepoint.com/:v:/g/personal/s_calvo_2022_alumnos_urjc_es/ERdaPF6J_EJJn2RCvck190wBRpmuiwg_alSuQGkwbhNQcw?nav=eyJyZWZlcnJhbEluZm8iOnsicmVmZXJyYWxBcHAiOiJPbmVEcml2ZUZvckJ1c2luZXNzIiwicmVmZXJyYWxBcHBQbGF0Zm9ybSI6IldlYiIsInJlZmVycmFsTW9kZSI6InZpZXciLCJyZWZlcnJhbFZpZXciOiJNeUZpbGVzTGlua0NvcHkifX0&e=4kfSNt" target="_blank">Ver el video</a>
        </div>
        <br>
    </div>



    <div class="footer">
        <h3>Contacto</h3>
        <p>Email: s.calvo.2022@alumnos.urjc.es</p>
        <p>Dirección:  Cam. del Molino, 5, 28942 Fuenlabrada, Madrid</p>
        <p>Ingenieria Robótica Software - Sistemas empotrados y de tiempo real</p>
    </div>
</body>
</html>
