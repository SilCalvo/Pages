<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CAR - AUTOPARKING</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-image: url('drone.png.webp');
            background-size: cover;
            background-repeat: no-repeat;
            background-attachment: fixed;
            background-position: center;
            color: white;
            height: 100vh;
            display: flex;
        }
        .sidebar {
            width: 125px;
            position: fixed;
            top: 10px;
            left: 10px;
            padding: 20px;
            background-color: rgba(0, 0, 0, 0.7);
            border-radius: 8px;
            margin-right: 5px;
        }
        .content {
            padding: 20px;
            background-color: rgba(0, 0, 0, 0.5);
            max-width: calc(60% - 50px);
            margin: auto;
            border-radius: 8px;
            flex: 1;
        }
        .fixed-box {
            width: 75px;
            height: 35px;
            position: fixed; 
            bottom: 20px;
            background-color: rgba(0, 0, 0, 0.9);
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            text-decoration: none;
            font-size: 20px;
        }
        .left-box {
            left: 20px;
        }
        .right-box {
            right: 20px;
        }
        a {
            color: white;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>

<div class="sidebar">
    <h3>Índice</h3>
    <ul>
        <li><a href="#INTRODUCCION">Introducción</a></li>
        <li><a href="#INICIO">Inicio</a></li>
        <li><a href="#HUECO">Hueco</a></li>
        <li><a href="#APARCAR">Aparcar</a></li>
        <li><a href="#CODIGO">Codigo</a></li>
        <li><a href="#VIDEO_DE_MUESTRA">Video de muestra</a></li>
    </ul>
    <div style="text-align: center; margin-top: 20px;">
        <a href="index.html" style="font-weight: bold;">Volver a la página principal</a>
    </div>
</div>

<div class="content">
    <div style="text-align: center;">
        <big><big><span style="font-weight: bold;">CAR - AUTOPARKING</span><br>
        <span style="font-weight: bold;">Silvia Calvo Cabello</span></big></big><br>
    </div>
    <br>
    
    <ul>
    <li><a name="INTRODUCCION"></a><span style="font-weight: bold;">INTRODUCCIÓN</span></li>
</ul>
La practica consiste en un coche autonomo. El coche tiene que poder aparcar en paralelo, ya sea teniendo dos coches de referencia (delante y detrás) o solo uno (delante o detrás). Para esto, cuenta con tres láseres de 180°: uno delante, uno detrás y uno a la derecha. Con ellos detectamos si hay hueco para aparcar y nos aseguramos de no chocar. Además, el coche tiene odometría, pero no se usará para localización global; solo servirá de manera incremental para movimientos relativos.
<br>
<ul>
    <li><a name="INICIO"></a><span style="font-weight: bold;">INICIO</span></li>
</ul>
Al principio, como no sabemos cómo está orientado ni posicionado el coche, este se coloca para que la calle quede paralela. Luego, se sitúa a la distancia correcta para poder aparcar.
<br>
<ul>
    <li><a name="HUECO"></a><span style="font-weight: bold;">HUECO</span></li>
</ul>
Probé varias formas de calcular el hueco. Primero contaba las líneas libres y usaba la media en el ángulo 90°, pero esto no funcionaba si el coche cambiaba la distancia respecto a los otros vehículos. Los ángulos calculados funcionaban solo en un escenario concreto, así que no era nada robusto.  
<br><br>
Después opté por calcular el hueco en metros reales entre los obstáculos. Esto resultó mucho más preciso y fiable, usando trigonometría para hacerlo.
<br>
<ul>
    <li><a name="APARCAR"></a><span style="font-weight: bold;">APARCAR</span></li>
</ul>
Al principio intenté aparcar con dos giros: primero hacia atrás y luego hacia adelante, pero no funcionaba.  
<br><br>
Luego probé a hacerlo como en la vida real: girar hacia atrás, continuar con el giro contrario y finalmente colocarte correctamente hacia adelante.  
<br><br>
Para calcular la maniobra, primero probé usando los láseres de delante y detrás, pero podría no haber un coche de referencia, así que finalmente usé la odometría incremental. También se usa para avanzar una distancia concreta una vez detectado el hueco, ya que no podemos asumir que siempre habrá un coche delante.
       <br> 
    <ul>
    <li><a name="CODIGO"></a><span style="font-weight: bold;">CODIGO</span></li>
    </ul>
    <h4>Explicaion del programa</h4>

    Este programa implementa un sistema de búsqueda y rescate autónomo con un dron, que utiliza visión por computadora para localizar personas en una zona determinada. El dron despega, se dirige a un punto de inicio predefinido y realiza un recorrido sistemático en zigzag sobre el área de búsqueda. Durante su vuelo, captura imágenes desde su cámara ventral y analiza cada fotograma para detectar rostros humanos utilizando un clasificador Haar Cascade entrenado con ejemplos de caras frontales.
<br><br>
Para mejorar la detección, el código ajusta el contraste de las imágenes mediante el algoritmo CLAHE (Contrast Limited Adaptive Histogram Equalization), que resalta los detalles de la cara sin sobreexponer el resto de la imagen. Además, se aplica una rotación progresiva de la imagen (en pasos de 10 grados) con el fin de detectar rostros aunque estén inclinados o girados respecto a la cámara.
<br><br>
Cuando se detecta un rostro, el programa calcula su posición real en el terreno en función de la altura y orientación del dron, el campo de visión de la cámara y las coordenadas de la imagen. A partir de esa información, convierte las coordenadas locales del dron a coordenadas geográficas UTM, de modo que se pueda registrar la ubicación exacta del posible “superviviente”.
<br><br>
El sistema evita registrar la misma persona varias veces mediante una comparación de posiciones. Si la nueva detección está muy cerca de una anterior, se considera repetida y no se guarda.
<br><br>
Mientras ejecuta su misión, el dron monitoriza constantemente su nivel de batería: si baja de un umbral (55%), interrumpe la búsqueda, regresa a un punto seguro, aterriza para simular una recarga, y luego despega de nuevo para continuar. Durante todo el proceso, el programa muestra en la interfaz del WebGUI tanto la imagen de la cámara frontal como la ventral, junto con información del vuelo, detecciones y estado del sistema.
<br><br>
Cuando la búsqueda termina al alcanzar el límite del área asignada, el dron aterriza y el programa muestra en consola las posiciones detectadas de las caras y sus correspondientes coordenadas UTM, completando así la misión de exploración y rescate.
      <br><br>
    

    <h4>Funciones del programa</h4>

<h5>get_yaw(target_x, target_y)</h5>
<p>
Calcula el ángulo de orientación yaw que el dron debe girar para mirar hacia un punto objetivo en el plano, 
utilizando su posición actual y las coordenadas de destino. Devuelve el ángulo en radianes, que luego se usa para orientar el dron correctamente durante el desplazamiento.
</p>

<h5>get_utm(coordinate)</h5>
<p>
Convierte las coordenadas locales del dron (en metros) a coordenadas geográficas UTM basadas en un punto de referencia inicial 
(latitud y longitud definidas en el código). Esto permite ubicar con precisión en el mapa las posiciones donde se detectaron rostros.
</p>

<h5>get_pose_face(centre_face)</h5>
<p>
Determina la posición real de un rostro detectado en la imagen en relación con el terreno, suponiendo un fov (el básico de cámaras)
Utiliza la altura del dron, su orientación yaw y los parámetros del campo de visión (FOV) de la cámara para convertir 
la posición del rostro en la imagen (en píxeles) a coordenadas métricas sobre el suelo.
</p>

<h5>is_new_face(centre_face)</h5>
<p>
Comprueba si una nueva cara detectada corresponde a una detección ya registrada previamente. 
Si la nueva posición está dentro de un rango de 3 metros respecto a una detección anterior, se considera la misma persona. 
En caso contrario, se añade la nueva posición a la lista de rostros detectados y se guarda su ubicación en coordenadas UTM.
</p>
<h5>go_to(pos_x,pos_y,altura)</h5>
<p>
Mueve el dron hasta una posición objetivo especificada por las coordenadas (pos_x, pos_y) y una altura determinada.  
Durante el desplazamiento, el dron ajusta su orientación (yaw) para dirigirse correctamente hacia el destino.  
Mientras avanza, se actualizan las imágenes del entorno en la interfaz WebGUI, se reduce progresivamente el nivel de batería y se muestra por consola la información de estado, incluyendo el número de personas detectadas y sus posiciones UTM.  
El bucle termina cuando el dron se encuentra a menos de 0.2 metros de la posición objetivo en los ejes X e Y.

</p>

<h5>detectAndDisplay(frame)</h5>
<p>
Procesa un fotograma de la cámara ventral para detectar rostros. 
Convierte la imagen a escala de grises, mejora el contraste usando el algoritmo CLAHE, 
y aplica rotaciones de la imagen en intervalos de 10 grados para detectar caras que estén inclinadas. 
Cuando encuentra una, calcula su posición original en la imagen sin rotar, la muestra medianteWebGUI, 
y llama a las funciones correspondientes para registrar la detección en el entorno del dron.
</p>
   <br>
    <ul>
        <li><a name="VIDEO_DE_MUESTRA"></a><span style="font-weight: bold;">VIDEO DE MUESTRA</span></li>
       <br> El siguiente video está acelerado x4 porque el dron va muy lento, se puede ver como despepga, va a la zona de busqueda, encuentra a personas y luego vuelve a cargar la bateria y aterriza y vuelve con su vuelo de busqueda encontrando a otra persona.
     <br><br>
    <a href="https://urjc-my.sharepoint.com/:v:/g/personal/s_calvo_2022_alumnos_urjc_es/EWyAxSN823RFpQgRVi58UgkB0aJHDRMP7pZMU5MSevOqWw?nav=eyJyZWZlcnJhbEluZm8iOnsicmVmZXJyYWxBcHAiOiJPbmVEcml2ZUZvckJ1c2luZXNzIiwicmVmZXJyYWxBcHBQbGF0Zm9ybSI6IldlYiIsInJlZmVycmFsTW9kZSI6InZpZXciLCJyZWZlcnJhbFZpZXciOiJNeUZpbGVzTGlua0NvcHkifX0&e=qouCT1" style="color: white;">Ver el video</a>
    
    
     <br>
     <br>

</div>

<a href="Serviceblogp2.html" class="fixed-box left-box">←</a>
<a href="index.html" class="fixed-box right-box">→</a>
</body>
</html>
