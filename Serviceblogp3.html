<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CAR - AUTOPARKING</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-image: url('imagesP3_.png');
            background-size: cover;
            background-repeat: no-repeat;
            background-attachment: fixed;
            background-position: center;
            color: white;
            height: 100vh;
            display: flex;
        }
        .sidebar {
            width: 125px;
            position: fixed;
            top: 10px;
            left: 10px;
            padding: 20px;
            background-color: rgba(0, 0, 0, 0.8);
            border-radius: 8px;
            margin-right: 5px;
        }
        .content {
            padding: 20px;
            background-color: rgba(0, 0, 0, 0.7);
            max-width: calc(60% - 50px);
            margin: auto;
            border-radius: 8px;
            flex: 1;
        }
        .fixed-box {
            width: 75px;
            height: 35px;
            position: fixed; 
            bottom: 20px;
            background-color: rgba(0, 0, 0, 0.9);
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            text-decoration: none;
            font-size: 20px;
        }
        .left-box {
            left: 20px;
        }
        .right-box {
            right: 20px;
        }
        a {
            color: white;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>

<div class="sidebar">
    <h3>Índice</h3>
    <ul>
        <li><a href="#INTRODUCCION">Introducción</a></li>
        <li><a href="#INICIO">Inicio</a></li>
        <li><a href="#HUECO">Hueco</a></li>
        <li><a href="#APARCAR">Aparcar</a></li>
        <li><a href="#CODIGO">Codigo</a></li>
        <li><a href="#VIDEO_DE_MUESTRA">Video de muestra</a></li>
    </ul>
    <div style="text-align: center; margin-top: 20px;">
        <a href="index.html" style="font-weight: bold;">Volver a la página principal</a>
    </div>
</div>

<div class="content">
    <div style="text-align: center;">
        <big><big><span style="font-weight: bold;">CAR - AUTOPARKING</span><br>
        <span style="font-weight: bold;">Silvia Calvo Cabello</span></big></big><br>
    </div>
    <br>
    
    <ul>
    <li><a name="INTRODUCCION"></a><span style="font-weight: bold;">INTRODUCCIÓN</span></li>
</ul>
La practica consiste en un coche autonomo. El coche tiene que poder aparcar en paralelo, ya sea teniendo dos coches de referencia (delante y detrás) o solo uno (delante o detrás). Para esto, cuenta con tres láseres de 180°: uno delante, uno detrás y uno a la derecha. Con ellos detectamos si hay hueco para aparcar y nos aseguramos de no chocar. Además, el coche tiene odometría, pero no se usará para localización global; solo servirá de manera incremental para movimientos relativos.
<br>
<ul>
    <li><a name="INICIO"></a><span style="font-weight: bold;">INICIO</span></li>
</ul>
Al principio, como no sabemos cómo está orientado ni posicionado el coche, este se coloca para que la calle quede paralela. Luego, se sitúa a la distancia correcta para poder aparcar.
<br>
<ul>
    <li><a name="HUECO"></a><span style="font-weight: bold;">HUECO</span></li>
</ul>
Para calcular el hueco mido las lineas con espacio estado a la derecha recto del coche. Cuando detecta que hay sufieciente hueco con la media en angulo 90, empieza a aparcar.
<br>

<ul>
    <li><a name="APARCAR"></a><span style="font-weight: bold;">APARCAR</span></li>
</ul>
Al principio intenté aparcar con dos giros: primero hacia atrás y luego hacia adelante, pero no funcionaba.  
<br><br>
Luego probé a hacerlo como en la vida real: girar hacia atrás, continuar con el giro contrario y finalmente colocarte correctamente hacia adelante.  
<br><br>
Para calcular la maniobra, primero probé usando los láseres de delante y detrás, pero podría no haber un coche de referencia, así que finalmente usé la odometría incremental. También se usa para avanzar una distancia concreta una vez detectado el hueco, ya que no podemos asumir que siempre habrá un coche delante.
       <br> 
    <ul>
    <li><a name="CODIGO"></a><span style="font-weight: bold;">CODIGO</span></li>
    </ul>
<h4>Explicación del programa</h4>

Este programa implementa un sistema de aparcamiento autónomo para un vehículo controlado mediante sensores láser y módulos de simulación proporcionados por la interfaz HAL y WebGUI.  
El objetivo es que el coche detecte un espacio libre en el lateral derecho, se coloque de forma paralela al entorno, y luego realice una maniobra de aparcamiento en varias fases hasta quedar correctamente estacionado entre dos obstáculos simulados.
<br><br>

El flujo principal comienza con una alineación del vehículo respecto a la acera (determinando si está paralelo mediante un análisis de los datos del láser derecho). Una vez que el coche está bien orientado, avanza por la vía mientras busca huecos adecuados para estacionar utilizando los datos del láser lateral.
<br><br>

Cuando se detecta un espacio libre que cumpla las condiciones de tamaño mínimo, el programa ejecuta la secuencia de maniobra de aparcamiento: avanza para posicionarse, da marcha atrás girando primero hacia un lado, luego hacia el contrario, y finalmente ajusta su orientación hasta quedar recto.
<br><br>

Durante todo el proceso, el sistema analiza los datos de los sensores delantero, trasero y lateral para evitar colisiones. También verifica si existen vehículos delante o detrás (mediante detección de distancias cortas), y modifica la estrategia en función de ello.
<br><br>

Una vez completada la maniobra, el vehículo se detiene completamente.
<br><br>

<h4>Funciones del programa</h4>

<h5>is_paralell()</h5>
<p>
Analiza los datos del láser derecho para determinar si el coche está paralelo a una pared o línea lateral.  <br>
El proceso consiste en segmentar los puntos válidos del láser, calcular el tramo más largo (la pared detectada), y obtener su pendiente mediante la diferencia entre el primer y último punto del segmento.  
<br>Si el ángulo de esa línea está dentro del rango de 89.5° a 90.8°, se considera que el coche está recto respecto a la pared y devuelve 90.  
<br>En caso contrario, devuelve el ángulo calculado, indicando el grado de desviación.
</p>

<h5>is_horizontal(laser)</h5>
<p>
Evalúa si los datos de un sensor láser (ya sea el delantero o el trasero) corresponden a una superficie horizontal al coche.  <br>
Divide las lecturas en segmentos continuos, calcula la inclinación de cada tramo y comprueba si alguno de ellos tiene un ángulo entre 89.5° y 90.5°.  <br>
Si lo encuentra, devuelve <code>True</code>, indicando que el coche está alineado correctamente frente a una pared u obstáculo.<br>
</p>

<h5>get_space()</h5>
<p>
Analiza las lecturas del láser derecho para detectar huecos libres que puedan ser utilizados como plazas de aparcamiento.  <br>
Considera un punto como “libre” si su distancia es igual o mayor que el rango máximo menos un umbral (threshold).  <br>
Cuando detecta una secuencia continua de puntos libres, la registra como un posible hueco, guardando el índice de inicio, fin y el número de lecturas consecutivas.  <br>
Devuelve una lista con todos los espacios detectados. <br>
</p>

<h5>is_parking_lot(wanted_mid, min_ang, min_count)</h5>
<p>
Determina si existe un espacio adecuado para aparcar en el área lateral del coche.  <br>
Utiliza los huecos encontrados por <code>get_space()</code> y verifica si alguno cumple con dos condiciones:  
que esté dentro del rango angular deseado y que tenga al menos un tamaño mínimo.  <br>
Si cumple ambos criterios, devuelve <code>True</code> e imprime el mensaje “Hueco detectado”.
</p>

<h5>park()</h5>
<p>
Ejecuta lamaniobra completa de aparcamiento en varias fases, controlando las velocidades lineal y angular del coche.  
<br>
Las etapas son: <br>
<ul>
<li><b>POSITION:</b> El vehículo avanza una distancia determinada hacia adelante para posicionarse antes de retroceder.</li>
<li><b>BACK_LEFT:</b> Da marcha atrás girando hacia la izquierda hasta alcanzar un ángulo de 35° respecto a la orientación inicial.</li>
<li><b>BACK_RIGHT:</b> Gira en sentido contrario (derecha) mientras sigue retrocediendo, hasta completar nuevamente un ángulo de 35°.  
Durante esta etapa se monitorea el sensor trasero para evitar colisiones con obstáculos cercanos.</li>
<li><b>FRONT:</b> Finalmente, avanza hacia adelante enderezando el vehículo, comprobando que no haya obstáculos ni vehículos delante.</li>
</ul>
El bucle finaliza cuando el coche queda recto (según los sensores) o cuando detecta una distancia de seguridad mínima.  
</p>

<h5>colocar_coche()</h5>
<p>
Función auxiliar encargada de ajustar la posición inicial del coche antes de iniciar la búsqueda de aparcamiento.  
Primero avanza hasta acercarse a una pared delantera (a 1.5 m), luego realiza un giro controlado hasta que la función <code>is_paralell()</code> determine que el coche está correctamente alineado (ángulo de 90°).  
Al finalizar, el coche queda preparado para recorrer la vía en busca de huecos.
</p>
   <br>
    <ul>
        <li><a name="VIDEO_DE_MUESTRA"></a><span style="font-weight: bold;">VIDEO DE MUESTRA</span></li>
       <br> A continuación se muestran varios videos. El primero, el coche se encuentra paralelo a la calle y hay dos coches de referencia. <br>
        En el segundo, el coche se encuentra girado respecto de la calle, y sigue habiendo dos coches de referencia.<br>
        Y el tercero, el coche se encuentra paralelo a la calle pero solo hay un coche de referencia.<br>
     <br><br>
    <a href="https://urjc-my.sharepoint.com/:v:/g/personal/s_calvo_2022_alumnos_urjc_es/Ea70vrbdpXtAvFrvevUJ5n8B-Phzk6yDjNe48mMYgtrMXQ?nav=eyJyZWZlcnJhbEluZm8iOnsicmVmZXJyYWxBcHAiOiJPbmVEcml2ZUZvckJ1c2luZXNzIiwicmVmZXJyYWxBcHBQbGF0Zm9ybSI6IldlYiIsInJlZmVycmFsTW9kZSI6InZpZXciLCJyZWZlcnJhbFZpZXciOiJNeUZpbGVzTGlua0NvcHkifX0&e=XqhnXf" style="color: white;">Ver el video V1</a>
        <br><br>
    <a href="https://urjc-my.sharepoint.com/:v:/g/personal/s_calvo_2022_alumnos_urjc_es/ESYWxkkFbHFHi5lOHzpdkscBhHo0r3N0rBdV8qrVJkPJiw?nav=eyJyZWZlcnJhbEluZm8iOnsicmVmZXJyYWxBcHAiOiJPbmVEcml2ZUZvckJ1c2luZXNzIiwicmVmZXJyYWxBcHBQbGF0Zm9ybSI6IldlYiIsInJlZmVycmFsTW9kZSI6InZpZXciLCJyZWZlcnJhbFZpZXciOiJNeUZpbGVzTGlua0NvcHkifX0&e=DFMjFY" style="color: white;">Ver el video V2</a>
        <br><br>
    <a href="https://urjc-my.sharepoint.com/:v:/g/personal/s_calvo_2022_alumnos_urjc_es/EVo29rayMEpCqOCuc8qigCMBNeN_N79-BUP9R9ca-Uv5Ng?nav=eyJyZWZlcnJhbEluZm8iOnsicmVmZXJyYWxBcHAiOiJPbmVEcml2ZUZvckJ1c2luZXNzIiwicmVmZXJyYWxBcHBQbGF0Zm9ybSI6IldlYiIsInJlZmVycmFsTW9kZSI6InZpZXciLCJyZWZlcnJhbFZpZXciOiJNeUZpbGVzTGlua0NvcHkifX0&e=ZuU8cj" style="color: white;">Ver el video V3</a>
    
    
     <br>
     <br>

</div>

<a href="Serviceblogp2.html" class="fixed-box left-box">←</a>
<a href="index.html" class="fixed-box right-box">→</a>
</body>
</html>
